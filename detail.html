<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detail Perusahaan per Kecamatan</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --color-primary:#004c99; --color-secondary:#0066cc; --color-green:#28a745;
      --color-yellow-accent:#ffc107; --color-background:#f0f3f6; --color-surface:#ffffff;
      --color-text-dark:#333; --color-text-light:#fff; --box-shadow:0 4px 12px rgba(0,0,0,.08);
      --border-radius:12px; --font-family:'Roboto','Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    }
    *{box-sizing:border-box}
    body{font-family:var(--font-family);background:var(--color-background);color:var(--color-text-dark);min-height:100vh;padding:20px;overflow-x:hidden}
    .container{max-width:1400px;margin:0 auto;background:var(--color-surface);border-radius:var(--border-radius);box-shadow:var(--box-shadow);padding:20px;display:flex;flex-direction:column;gap:25px}
    header{display:flex;align-items:center;justify-content:space-between;background:var(--color-surface);padding:10px 20px;box-shadow:var(--box-shadow);border-radius:var(--border-radius)}
    .header-section{display:flex;align-items:center}
    .header-logo{height:80px;margin-right:15px;border-radius:8px}
    .header-title{text-align:center;flex-grow:1}  
    .header-title h1{font-size:1.5rem;color:var(--color-primary);font-weight:700;margin-bottom:5px}
    .header-title p{font-size:1rem;font-weight:500;color:#000;font-style:italic}
    .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #008000; /* Hijau solid, lebih mirip gambar */
            color: var(--color-text-light);
            padding: 8px 15px; /* Padding sedikit lebih besar */
            margin-bottom: 5px; 
            font-weight: 500;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            font-size: 1em; 
        }
    .nav-button,.refresh-button{background:var(--color-text-light);color:var(--color-primary);padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:bold;transition:.3s;border:none;cursor:pointer}
    .nav-button:hover,.refresh-button:hover{background:#e9eef2;transform:translateY(-2px)}
    .status-indicator{padding:4px 8px;border-radius:4px;font-size:.8em;font-weight:bold;text-transform:uppercase}
    .status-online{background:#d4edda;color:#155724}.status-loading{background:#fff3cd;color:#856404}.status-error{background:#f8d7da;color:#721c24}
    h2{font-size:1.6rem;font-weight:700;margin-bottom:12px;color:var(--color-primary);text-align:center}
    .panel{background:var(--color-surface);padding:15px;border:1px solid #edf2f7;border-radius:var(--border-radius);box-shadow:var(--box-shadow);margin-bottom:10px}
    .summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .card{padding:12px;border-radius:var(--border-radius);box-shadow:var(--box-shadow);text-align:center;color:var(--color-text-light)}
    .card h3{font-size:.95rem;margin-bottom:6px}
    .card .value{font-size:1.8rem;font-weight:700}
    .card.kecamatan{background:linear-gradient(135deg,var(--color-yellow-accent),#e0a800);color:#222}
    .card.total-projects{background:linear-gradient(135deg,var(--color-green),#20c997)}
    .card.total-tk{background:linear-gradient(135deg,#dc3545,#c82333)}
    .card.total-iuran{background:linear-gradient(135deg,var(--color-primary),#0056b3)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:8px}
    .search-input{padding:10px 12px;border:1px solid #d9e2ec;border-radius:8px;min-width:240px;outline:none}
    .info-badge{background:#eef5ff;color:var(--color-primary);padding:6px 10px;border-radius:8px;font-weight:600}
    .data-table-container{width:100%;overflow:auto;border:1px solid #edf2f7;border-radius:var(--border-radius);max-height:calc(100vh - 260px)}
    table{width:100%;min-width:900px;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid #edf2f7;text-align:left}
    thead th{position:sticky;top:0;z-index:6;background:linear-gradient(135deg,var(--color-primary),#0056b3);color:#fff;text-transform:uppercase;font-size:.85rem;letter-spacing:.3px}
    tr:nth-child(even){background:#f8fafc} tr:hover{background:#edf2f7;transition:.2s}
    .center-text{text-align:center}.right-text{text-align:right}
    .progress-container{width:100%;background:#f0f0f0;border-radius:10px;margin:10px 0;overflow:hidden}
    .progress-bar{height:20px;background:var(--color-primary);width:0%;transition:width .3s;text-align:center;color:#fff;line-height:20px;font-size:12px}
    .loading-spinner{border:4px solid #f3f3f3;border-top:4px solid var(--color-primary);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto}
    .header-person {
            height: 35px; 
            margin-left: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        } 
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    @media(max-width:900px){.header-title{display:none}.data-table-container{max-height:60vh}}

    /* ==== Fit di dalam kotak: desktop (≥901px) ==== */
@media (min-width:901px){
  body{ overflow-y: hidden; }                       /* halaman tidak ikut scroll */
  .container{ position: sticky; top:10px;
    max-height: calc(100vh - 20px); overflow: hidden; }
  /* Panel tabel: hanya area tabel yang scroll (vertikal) */
  .panel .data-table-container{
    max-height: calc(100vh - 300px);               /* sesuaikan jika header/summary berubah */
    overflow-y: auto; overflow-x: hidden;
  }
}

/* ==== Hilangkan scroll horizontal di tabel ==== */
.data-table-container{ overflow-x: hidden; }
table{ width:100%; table-layout: fixed; min-width:auto; }
th, td{ white-space: normal; word-break: break-word; }
thead th{ /* biar header tetap rapat */
  padding: 10px 8px;
}
th:nth-child(1){ width:52px; }      /* No */
th:nth-child(3){ width:110px; }     /* TK Aktif */
th:nth-child(4){ width:150px; }     /* Total Iuran */

/* ==== Mobile (≤900px): halaman boleh scroll, tabel tetap di panel ==== */
@media (max-width:900px){
  body{ overflow-y: auto; }
  .panel .data-table-container{ max-height: 60vh; }
  /* Ringkas tampilan: sembunyikan kolom Alamat agar tidak melebar */
  th:nth-child(5), td:nth-child(5){ display: none; }
  .card .value{ font-size: 1.4rem; }
  .search-input{ min-width: 180px; }
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-section">
        <img src="medan.png" class="header-logo" alt="Medan">
        <img src="pemprovsu.png" class="header-logo" alt="Pemprovsu">
      </div>
      <div class="header-title">
        <h1>Data Pemberi Kerja/Badan Usaha Kantor Cabang Medan Kota</h1>
        <p>(Detail Perusahaan per Kecamatan)</p>
      </div>
      <div class="header-section">
        <img src="logo.png" class="header-logo" alt="BPJS Ketenagakerjaan">
      </div>
    </header>

    <div class="top-bar">
      <div>
        <span id="currentDate"></span>
        <span id="connectionStatus" class="status-indicator status-loading">Memuat…</span>
      </div>
      <div class="top-bar-nav">
          <a href="index.html" class="nav-button">Home</a>
          <a href="topworst.html" class="nav-button">Top & Worst</a>
      </div>
      <div class="top-bar-right" style="display: flex; align-items: center;">
          <img src="semua.png" alt="Medan" class="header-person" style="margin-left: 5px;">
      </div>
    </div>

    

    <!-- Ringkasan -->
    <div class="panel">
      <h2>Rekap Perusahaan Berdasarkan Kecamatan <div class="value" id="kecamatanName">-</div> </h2>
      <div class="summary-cards">
        <!-- <div class="card kecamatan">
          <h3>Kecamatan</h3>
          <div class="value" id="kecamatanName">-</div>
        </div> -->
        <div class="card total-projects">
          <h3>Total Perusahaan</h3>
          <div class="value" id="totalCompanies">0</div>
        </div>
        <div class="card total-tk">
          <h3>Total Tenaga Kerja</h3>
          <div class="value" id="totalTK">0</div>
        </div>
        <!-- <div class="card total-iuran">
          <h3>Total Iuran Berjalan</h3>
          <div class="value" id="totalIuran">Rp 0</div>
        </div> -->
      </div>
    </div>

    <!-- Tabel Detail -->
    <div class="panel">
      <div class="toolbar">
        <h2 id="tableTitle">Detail Perusahaan</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="search" class="search-input" placeholder="Cari nama perusahaan…"/>
          <span id="rowCount" class="info-badge">0 data</span>
        </div>
      </div>
      <div class="progress-container" id="progressContainer" style="display:none">
        <div class="progress-bar" id="progressBar">0%</div>
      </div>
      <div class="data-table-container">
        <table>
          <thead>
            <tr>
              <th style="min-width:60px">No.</th>
              <th class="center-text" style="min-width:280px">Nama Perusahaan</th>
              <th class="center-text" style="min-width:120px">TK Aktif</th>
              <th class="right-text" style="min-width:180px">Iuran terakhir</th>
              <th class="center-text" style="min-width:180px">Alamat</th>
              <th class="center-text" style="min-width:180px">No Hp PIC</th>
            </tr>
          </thead>
          <tbody id="detailBody">
            <tr>
              <td colspan="5" style="text-align:center;padding:20px;color:#666">
                <div class="loading-spinner"></div>
                <p style="margin-top:10px">Memuat data…</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<script>
/* =======================
   DETAIL PAGE – FIXED (v3)
   ======================= */

let allData = [];
let filtered = [];

// Config Google Sheets
const SHEET_CONFIG = {
  sheetId: "1bi7beUHCGem8U7-huUarJY1V1pfTPLqSCRwghMjAehk",
  apiKey:  "AIzaSyDDChj-Syqytv2HboLnbflQu7-u_5VAYIE",
  range:   "Sheet1!A1:N11000"
};

// ---- Cache helpers (bump version to avoid old numeric cache) ----
const CACHE_KEY = "companyData_v3";
const CACHE_TTL_MS = 2 * 60 * 1000; // 2 menit

function readCache(){
  try{ const raw = sessionStorage.getItem(CACHE_KEY); return raw ? JSON.parse(raw) : null; }
  catch(e){ return null; }
}
function writeCache(data){
  try{ sessionStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), data })); }
  catch(e){}
}

document.addEventListener('DOMContentLoaded', init);

async function init(){
  updateCurrentDate();
  updateConnectionStatus('loading','Memuat data…');

  const kec = decodeURIComponent(new URLSearchParams(location.search).get('kecamatan') || '');
  const kecLabel = kec || 'Lain-lain';
  byId('kecamatanName').textContent = kecLabel;
  byId('tableTitle').textContent    = `Detail Perusahaan — ${kecLabel}`;

  // 1) Ambil cache bila ada
  let cache = readCache();
  if (cache && Array.isArray(cache.data)) {
    allData = cache.data;
  }

  // 2) Render cepat bila ada data
  if (allData.length > 0) {
    applyFilterByKecamatan(kec);
  }

  // 3) Refresh bila cache kosong/kadaluarsa
  const isStale = !cache || (Date.now() - cache.ts > CACHE_TTL_MS) || allData.length === 0;
  if (isStale) {
    showProgress(true);
    await fetchFromSheet();     // isi allData terbaru (string values)
    showProgress(false);
    applyFilterByKecamatan(kec);
  } else {
    updateConnectionStatus('online', `${allData.length} data (cache)`);
  }

  bindSearch();
  onClick('btnExport', exportCSV);
}

/* =======================
   Data fetching & mapping
   ======================= */
async function fetchFromSheet(){
  updateProgressBar(10,'Mengambil data dari Google Sheets…');
  try{
    // PENTING: paksa API mengembalikan nilai TERFORMAT (string seperti di Sheet)
    const url =
      `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_CONFIG.sheetId}/values/${SHEET_CONFIG.range}` +
      `?valueRenderOption=FORMATTED_VALUE&dateTimeRenderOption=FORMATTED_STRING&key=${SHEET_CONFIG.apiKey}`;

    const res = await fetch(url);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    updateProgressBar(50,'Memproses data…');
    if(!data.values || data.values.length===0) throw new Error('Sheet kosong');

    const headers = data.values[0];
    allData = data.values.slice(1).map(row => mapRow(headers,row));

    writeCache(allData); // cache baru (v3)
    updateProgressBar(100,'Selesai');
    updateConnectionStatus('online', `${allData.length} data dimuat`);
  }catch(err){
    console.error('Fetch error:', err);
    updateConnectionStatus('error','Gagal memuat data');
    showError('Gagal memuat data dari Google Sheets.');
  }
}

function isNamaPerusahaanHeader(key) {
  key = String(key || '').toLowerCase().trim();
  const patterns = [
    'nama perusahaan','nama pemberi kerja','nama badan usaha','nama instansi',
    'pemberi kerja/badan usaha','pemberi kerja / badan usaha','perusahaan'
  ];
  return patterns.some(p => key.includes(p));
}

function mapRow(headers, row){
  const c = {
    namaPerusahaan:'', alamat:'', kecamatan:'', skalaUsaha:'', program:'',
    tkAktif:0, nilaiPosting:0, noHpPic:'', iuranTerakhir:''   // <— TAMBAH INI
  };

  headers.forEach((h,i)=>{
    const key  = String(h||'').toLowerCase().trim();
    const cell = (row[i] == null) ? '' : String(row[i]);

    // Nama Perusahaan (longgar)
    if (!c.namaPerusahaan && isNamaPerusahaanHeader(key)) {
      if (cell.trim() !== '') c.namaPerusahaan = cell;
      return;
    }

    // Alamat / Kecamatan
    if (key.includes('alamat')){
      c.alamat = cell;
      if (!c.kecamatan) c.kecamatan = extractKecamatanFromAlamat(cell);
      return;
    }
    if (key.includes('kecamatan')){
      if (cell.trim() !== '') c.kecamatan = cell;
      return;
    }

    // Skala / Program
    if (key.includes('skala') || key.includes('usaha')) c.skalaUsaha = cell;
    if (key.includes('prog')  || key.includes('program')) c.program = cell;

    // TK Aktif (boleh jadi string; kita parse aman)
    if (key.includes('tk') || key.includes('aktif') || key.includes('tenaga') || key.includes('kerja')){
      let v = parseInt(cell.replace(/[^\d]/g,'')) || 0;
      c.tkAktif = v;
      return;
    }

    // Total Iuran / Nilai Posting
    if ((key.includes('iuran') && key.includes('terakhir')) || key === 'iuran terakhir') {
      c.iuranTerakhir = normalizeIuranTerakhir(cell);
      return;
    }


    // No HP PIC — hanya jika header terkait telepon & kontak/PIC
    const isPhone = (key.includes('no hp') || key.includes('hp') || key.includes('telepon') || key.includes('telp') ||
                     key.includes('phone') || key.includes('wa') || key.includes('whatsapp'));
    const isPic   = (key.includes('pic') || key.includes('kontak') || key.includes('cp') || key.includes('contact'));
    if (!c.noHpPic && (isPhone && (isPic || key.includes('pic') || key.includes('cp')))) {
      c.noHpPic = cell; // simpan PERSIS teks dari Sheet (leading zero, +62, spasi, strip, dll)
      return;
    }
    // (opsional) kalau kolomnya cuma "No HP" tanpa kata PIC, boleh longgarkan:
    // else if (!c.noHpPic && isPhone) { c.noHpPic = cell; return; }
  });

  // Fallback nama perusahaan
  if (!c.namaPerusahaan) {
    const candidates = [];
    headers.forEach((h,i)=>{
      const key = String(h||'').toLowerCase().trim();
      if (isNamaPerusahaanHeader(key) && row[i] && String(row[i]).trim() !== '') {
        candidates.push(String(row[i]));
      }
    });
    if (candidates.length > 0) c.namaPerusahaan = candidates[0];
  }
  if (!c.namaPerusahaan) c.namaPerusahaan = row[3] || '';

  if (!c.kecamatan) c.kecamatan = extractKecamatanFromAlamat(c.alamat);
  return c;
}

/* =======================
   Filtering & Rendering
   ======================= */
function applyFilterByKecamatan(kecParam){
  const target=(kecParam||'').toLowerCase().trim();

  filtered = allData.filter(c => (c.kecamatan||'').toLowerCase().trim() === target);
  if(target==='lain-lain'){
    filtered = allData.filter(c=>{
      const kc=(c.kecamatan||'').toLowerCase().trim();
      const known=kc.startsWith('medan ');
      return !known || kc==='' || kc==='lain-lain';
    });
  }

  // sort by iuran desc
  filtered.sort((a,b)=> (b.nilaiPosting||0)-(a.nilaiPosting||0));

  renderTable(filtered);
  updateSummary(filtered);
}

function renderTable(data){
  const body = byId('detailBody');
  body.innerHTML='';

  if(!data || data.length===0){
    body.innerHTML = `<tr><td colspan="6" style="text-align:center;padding:16px;color:#666">Tidak ada data</td></tr>`;
    byId('rowCount').textContent='0 data';
    return;
  }

  data.forEach((c,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${escapeHTML(c.namaPerusahaan||'-')}</td>
      <td class="center-text">${Number(c.tkAktif||0).toLocaleString('id-ID')}</td>
      <td class="center-text">${escapeHTML(c.iuranTerakhir || '-')}</td>
      <td>${escapeHTML(c.alamat||'-')}</td>
      <td>${renderPhone(c.noHpPic)}</td>
    `;
    body.appendChild(tr);
  });

  byId('rowCount').textContent = `${data.length.toLocaleString('id-ID')} data`;
}



function renderPhone(val){
  const raw = (val == null) ? '' : String(val).trim(); // selalu string
  if(!raw) return '-';
  const telHref = raw.replace(/[^\d+]/g,'');           // hanya dipakai untuk href tel:
  return telHref
    ? `<a class="instansi-link" href="tel:${telHref}">${escapeHTML(raw)}</a>`
    : escapeHTML(raw);
}

function updateSummary(data){
  const totalCompanies = data.length;
  const totalTK = data.reduce((s,c)=> s + (Number(c.tkAktif||0)), 0);
  const totalIuran = data.reduce((s,c)=> s + (Number(c.nilaiPosting||0)), 0);
  byId('totalCompanies').textContent = totalCompanies.toLocaleString('id-ID');
  byId('totalTK').textContent        = totalTK.toLocaleString('id-ID');
  byId('totalIuran').textContent     = formatCurrency(totalIuran);
}

function bindSearch(){
  const input = byId('search');
  if(!input) return;

  const onType = ()=>{
    const q=(input.value||'').toLowerCase();
    const qNum = q.replace(/[^\d+]/g,''); // versi numerik query
    const res = filtered.filter(c => {
      const nama   = (c.namaPerusahaan||'').toLowerCase();
      const alamat = (c.alamat||'').toLowerCase();
      const phone  = (c.noHpPic==null ? '' : String(c.noHpPic)).toLowerCase();
      const phoneNum = phone.replace(/[^\d+]/g,'');
      return (
        nama.includes(q) ||
        alamat.includes(q) ||
        phone.includes(q) ||              // cocokkan apa adanya
        (qNum && phoneNum.includes(qNum)) // juga cocokkan versi numerik
      );
    });
    renderTable(res);
  };

  input.addEventListener('input', onType);
  onType(); // initial
}

/* =======================
   Export
   ======================= */
function exportCSV(){
  const rows=[["No","Nama Perusahaan","TK Aktif","Iuran Terakhir","Alamat","No Hp PIC"]];
  filtered.forEach((c,i)=> rows.push([
    i+1,
    c.namaPerusahaan||'',
    Number(c.tkAktif||0),
    String(c.iuranTerakhir||''),
    c.alamat||'',
    String(c.noHpPic||'')
  ]));
  const csv = rows.map(r=> r.map(escapeCSV).join(',')).join('\n');
  const blob=new Blob(["\ufeff"+csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  const kec=byId('kecamatanName').textContent||'kecamatan';
  a.download=`detail_perusahaan_${kec.replace(/\s+/g,'_').toLowerCase()}.csv`;
  document.body.appendChild(a); a.click(); a.remove();
}


/* =======================
   Helpers
   ======================= */
function byId(id){ return document.getElementById(id); }
function onClick(id, fn){ const el=byId(id); if(el) el.addEventListener('click', fn); }
function showProgress(show){ const pc=byId('progressContainer'); if(pc) pc.style.display = show ? 'block' : 'none'; }

function extractKecamatanFromAlamat(alamat){
  if(!alamat||typeof alamat!=='string') return 'Lain-lain';
  const low = alamat.toLowerCase();
  const list = ["medan amplas","medan area","medan barat","medan baru","medan belawan","medan deli","medan denai","medan helvetia","medan johor","medan kota","medan labuhan","medan maimun","medan marelan","medan perjuangan","medan petisah","medan polonia","medan selayang","medan sunggal","medan tembung","medan timur","medan tuntungan"];
  for(const k of list){ if(low.includes(k)) return capitalizeWords(k); }
  const m = low.match(/(medan\s+\w+)/i); if(m){ return capitalizeWords(m[1]); }
  return 'Lain-lain';
}
function capitalizeWords(str){ return String(str||'').replace(/\w\S*/g,t=>t[0].toUpperCase()+t.slice(1).toLowerCase()); }
function toNumber(x){
  if(typeof x==='number') return x;
  if(typeof x!=='string') return 0;
  let v=x.replace(/[^\d,.-]/g,'');
  if(v.includes(',')&&v.includes('.')) v=v.replace(/\./g,'').replace(',', '.');
  else if(v.includes(',')) v=v.replace(/,/g,'');
  const n=parseFloat(v); return isNaN(n)?0:n;
}
function formatCurrency(n){ return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0,maximumFractionDigits:0}).format(Number(n||0)); }
function updateCurrentDate(){
  const now=new Date();
  const s = now.toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit',timeZone:'Asia/Jakarta'});
  const el = byId('currentDate'); if(el) el.textContent = s;
}
function updateConnectionStatus(s,m){ const el=byId('connectionStatus'); if(el){ el.className=`status-indicator status-${s}`; el.textContent=m; } }
function updateProgressBar(p,msg){ const bar=byId('progressBar'); if(bar){ bar.style.width=`${p}%`; bar.textContent=`${p}% - ${msg}`; } }
function escapeHTML(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
function escapeCSV(v){const s=String(v??''); return /[",\n]/.test(s)? '"'+s.replace(/"/g,'""')+'"' : s;}
function showError(m){
  const d=document.createElement('div');
  d.innerHTML=`<div style="position:fixed;top:20px;right:20px;background:#dc3545;color:#fff;padding:15px;border-radius:8px;z-index:10000;max-width:300px;">${m}<button onclick="this.parentElement.remove()" style="float:right;background:none;border:none;color:#fff;font-size:18px;margin-left:10px">&times;</button></div>`;
  document.body.appendChild(d); setTimeout(()=>{d.remove?.()},5000);
}

/* ====== Tambah util untuk normalisasi iuran terakhir ====== */
function normalizeIuranTerakhir(cell) {
  const s = String(cell || '').trim();

  // Sudah "MM-YYYY"
  if (/^\d{2}-\d{4}$/.test(s)) return s;

  // "M-YYYY" -> pad leading zero
  const mDash = s.match(/^(\d{1})-(\d{4})$/);
  if (mDash) return `${mDash[1].padStart(2, '0')}-${mDash[2]}`;

  // "Sep 2025" / "September 2025" / "SEP-2025"
  const mText = s.match(/^([A-Za-z]+)[\s\-]?(\d{4})$/);
  if (mText) {
    const monthMap = {
      jan: '01', januari:'01',
      feb: '02', februari:'02',
      mar: '03', maret:'03',
      apr: '04', april:'04',
      may: '05', mei:'05',
      jun: '06', juni:'06',
      jul: '07', juli:'07',
      aug: '08', agustus:'08', agst:'08',
      sep: '09', september:'09',
      oct: '10', okt:'10', oktober:'10',
      nov: '11', november:'11',
      dec: '12', des:'12', desember:'12'
    };
    const mm = monthMap[mText[1].toLowerCase()] || '';
    if (mm) return `${mm}-${mText[2]}`;
  }

  // "YYYY-MM" -> balik
  const yFirst = s.match(/^(\d{4})[-\/\.](\d{1,2})$/);
  if (yFirst) return `${String(yFirst[2]).padStart(2,'0')}-${yFirst[1]}`;

  // fallback: biarkan apa adanya
  return s;
}



</script>


</body>
</html>
